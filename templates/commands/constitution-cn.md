---
description: 根据交互式或提供的原则输入，创建或更新项目宪法，并确保所有相关的模板保持同步。
handoffs: 
  - label: 构建规格说明 (Specification)
    agent: speckit.specify
    prompt: 根据更新后的宪法实现功能规格说明。我想要构建...
---

## 用户输入

```text
$ARGUMENTS
```

在继续之前，您**必须**考虑用户输入（如果不为空）。

## 纲要

您正在更新位于 `/memory/constitution.md` 的项目宪法。该文件是一个包含方括号占位符（例如 `[PROJECT_NAME]`, `[PRINCIPLE_1_NAME]`）的模板。您的任务是 (a) 收集/推导具体值，(b) 准确填充模板，以及 (c) 在相关产物中传播任何修订内容。

遵循以下执行流程：

1. 加载 `/memory/constitution.md` 处的现有宪法模板。
   - 识别格式为 `[ALL_CAPS_IDENTIFIER]` 的每个占位符。
   **重要提示**：用户可能需要的原则数量少于或多于模板中使用的原则数量。如果指定了数量，请尊重该数量 —— 遵循通用模板。您将相应地更新文档。

2. 收集/推导占位符的值：
   - 如果用户输入（对话）提供了值，则使用它。
   - 否则从现有的仓库上下文（README, 文档, 嵌入的早期宪法版本）中推断。
   - 对于治理日期：`RATIFICATION_DATE` 是最初通过的日期（如果未知，请询问或标记为 TODO），`LAST_AMENDED_DATE` 如果有更改则为今天，否则保留之前的日期。
   - `CONSTITUTION_VERSION` 必须根据语义化版本规则递增：
     - MAJOR (主版本)：向后不兼容的治理/原则移除或重新定义。
     - MINOR (次版本)：新增原则/章节或实质性扩展指南。
     - PATCH (修订号)：澄清、措辞、拼写错误修复、非语义精炼。
   - 如果版本提升类型不明确，在确定之前提出理由。

3. 起草更新后的宪法内容：
   - 将每个占位符替换为具体文本（除该项目选择尚未定义的故意保留的模板槽位外，不留带括号的令牌 —— 对任何留下的内容进行明确说明）。
   - 保留标题层级，注释在替换后可以移除，除非它们仍能提供澄清性的指导。
   - 确保每个原则章节：简明的名称行，包含不可协商规则的段落（或项目列表），如果理由不显而易见，则说明其合理性。
   - 确保“治理 (Governance)”章节列出了修订程序、版本控制政策和合规审查预期。

4. 一致性传播检查表（将之前的检查表转换为主动验证）：
   - 读取 `/templates/plan-template.md`，并确保任何“宪法检查”或规则与更新后的原则保持一致。
   - 读取 `/templates/spec-template.md` 以确保范围/需求对齐 —— 如果宪法增加/删除了强制性章节或约束，请进行更新。
   - 读取 `/templates/tasks-template.md`，并确保任务分类反映了新的或已移除的原则驱动的任务类型（例如，可观测性、版本控制、测试规范）。
   - 读取 `/templates/commands/*.md` 中的每个命令文件（包括本文件），以验证在需要通用指南时，没有遗留特定于 agent 的名称（如 CLAUDE）。
   - 读取任何运行时指南文档（例如 `README.md`, `docs/quickstart.md` 或 agent 特有的指南文件（如有））。更新对已更改原则的引用。

5. 生成“同步影响报告”（更新后作为 HTML 注释置于宪法文件顶部）：
   - 版本变更：旧版本 → 新版本
   - 修改后的原则列表（如果重命名，则为 旧标题 → 新标题）
   - 新增章节
   - 移除章节
   - 需要更新的模板（✅ 已更新 / ⚠ 待定）及其文件路径
   - 如果有故意推迟的占位符，列出后续 TODO。

6. 最终输出前的验证：
   - 没有遗留未解释的括号令牌。
   - 版本行与报告匹配。
   - 日期采用 ISO 格式 YYYY-MM-DD。
   - 原则应是声明性的、可测试的，并且没有模糊语言（将 "should" 替换为 MUST/SHOULD 理由，如果合适）。

7. 将完成后的宪法写回 `/memory/constitution.md`（覆盖）。

8. 向用户输出最终摘要，包括：
   - 新版本和版本提升理由。
   - 标记为需要手动跟进的任何文件。
   - 建议的提交信息（例如：`docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

格式与风格要求：

- 完全按照模板使用 Markdown 标题（不要降级/升级层级）。
- 对长的理由说明行进行换行，以保持可读性（理想情况下 <100 字符），但不要强制使用别扭的换行。
- 章节之间保持一个空行。
- 避免行尾空格。

如果用户提供了部分更新（例如，仅修订一个原则），仍需执行验证和版本决策步骤。

如果关键信息缺失（例如，通过日期确实未知），插入 `TODO(<FIELD_NAME>): 解释`，并将其包含在同步影响报告的推迟项下。

不要创建新模板；始终在现有的 `/memory/constitution.md` 文件上进行操作。
